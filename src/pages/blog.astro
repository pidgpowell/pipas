---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";

const allAboutPosts = await getCollection("post");
---

<Layout title="Blog | Pipas">
  <h2>Blog</h2>
  <section
    class="max-w-4xl px-0 mx-auto sm:p-8 sm:pb-24 sm:pt-16 lg:pb-48 scroll-mt-56"
  >
    {
      allAboutPosts.map((post, index) => (
        <a
          href={`post/${post.slug}`}
          class="flex flex-col max-w-4xl p-0 mx-auto mb-8 text-left sm:border sm:flex-row gap-4 sm:gap-8 prose hover:text-red-500 group"
        >
          <Image
            src={post.data.img.src}
            alt={post.data.title}
            widths={[240, 540, 720, post.data.img.src.width]}
            sizes={`(max-width: 360px) 240px, (max-width: 720px) 540px, (max-width: 1600px) 720px, ${post.data.img.src.width}px`}
            class="object-cover w-full h-auto sm:max-w-sm aspect-auto"
            loading={index < 3 ? "eager" : "lazy"}
          />
          <div class="px-4 py-0 sm:pb-20 sm:py-6 sm:pr-4 sm:pl-0">
            <h3 class="group-hover:text-red-500">{post.data.title}</h3>
            <p class="whitespace-normal line-clamp-3">{post.data.preview}</p>
            <hr class="block mt-4 sm:hidden" />
          </div>
        </a>
      ))
    }
  </section>
</Layout>
